---
title: "æ¥•å††æ›²ç·šæš—å·ã®ãŸã‚ã®æ•°å­¦6ï¼ˆGLVæ³•ã¨è‡ªå·±æº–åŒå‹å†™åƒï¼‰"
emoji: "ğŸ§®"
type: "tech"
topics: ["æ¥•å††æ›²ç·šæš—å·", "ã‚¹ã‚«ãƒ©ãƒ¼å€ç®—", "MSM", "GLV"]
published: true
---
## åˆã‚ã«
ä»Šå›ã¯ã€æ¥•å††æ›²ç·šã®æ•°å­¦çš„ãªæ€§è³ªã‚’ç”¨ã„ãŸã‚¹ã‚«ãƒ©ãƒ¼å€ç®—ã®é«˜é€ŸåŒ–æ‰‹æ³•ã®ä¸€ã¤ã€GLVæ³•ï¼ˆGallant-Lambert-Vanstoneï¼‰ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚
GLVæ³•ã¯å°ã•ã„ãƒãƒ«ãƒã‚¹ã‚«ãƒ©ãƒ¼å€ç®—ã‚’åˆ©ç”¨ã™ã‚‹ã®ã§ã€ã¾ãšãã¡ã‚‰ã‹ã‚‰è§£èª¬ã—ã¾ã—ã‚‡ã†ã€‚

## ãƒãƒ«ãƒã‚¹ã‚«ãƒ©ãƒ¼å€ç®—
ä¸€èˆ¬ã«ã€æ¥•å††æ›²ç·šã®ç‚¹ $P_1, \dots, P_n$, æ•´æ•° $a_1, \dots, a_n$ ãŒä¸ãˆã‚‰ã‚ŒãŸã¨ãã«

$$
Q=a_1 P_1 + \dots + a_n P_n
$$

ã‚’æ±‚ã‚ã‚‹æ“ä½œã‚’ãƒãƒ«ãƒã‚¹ã‚«ãƒ©ãƒ¼å€ç®— ï¼ˆMSM : multi-scalar multiplicationï¼‰ã¨ã„ã„ã¾ã™ã€‚
zk-SNARKãªã©ã§ã¯å¤§ããª $n$ï¼ˆæ•°åƒ~æ•°ä¸‡ï¼‰ã«å¯¾ã™ã‚‹MSMãŒç¾ã‚Œã¾ã™ã€‚ãã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ã¾ãŸã®æ©Ÿä¼šã«ç´¹ä»‹ã™ã‚‹ã¨ã—ã¦ã€ã“ã“ã§ã¯ $n=2$, ã¤ã¾ã‚Šæ¥•å††æ›²ç·šã®ç‚¹ $P_1$, $P_2$ ã¨ã€æ•´æ•° $x_1$, $x_2$ ã«å¯¾ã—ã¦ $Q=x_1 P_1 + x_2 P_2$ ã‚’æ±‚ã‚ã‚‹æ‰‹æ³•ã‚’è€ƒå¯Ÿã—ã¾ã™ã€‚
ã‚‚ã¡ã‚ã‚“ã€$x_1 P_1$ ã¨ $x_2 P_2$ ã‚’æ±‚ã‚ã¦è¶³ã›ã° $Q$ ãŒæ±‚ã¾ã‚Šã¾ã™ãŒã€ãã‚Œã‚ˆã‚Šã‚‚ã‚ˆã„æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚
$x_i P_i$ ã®è¨ˆç®—ã¯å‰å›ã¾ã§ã® $w$ ãƒ“ãƒƒãƒˆã®[NAF](https://zenn.dev/herumi/articles/ecc-mul-win-naf)ãªã©ç”¨ã„ã¦è¨ˆç®—ã™ã‚‹ã®ã§ã™ãŒã€ãã®ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã¯æ¬¡ã®å½¢ã§ã—ãŸã€‚

```python
# return P * x
def mul(P, x, w):
  # w ãƒ“ãƒƒãƒˆNAFãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
  naf = make_NAF(x, w)
  tbl = make_table(P, w)
  Q = Ec()
  for v in range(naf):
    Q = dbl(Q)
    if v:
      Q = add(Q, tbl[v]) if v > 0 else sub(Q, tbl[-v])
  return Q
```

ãƒ«ãƒ¼ãƒ—ã®ä¸­ã§ $Q$ ã‚’dblã—ãªãŒã‚‰ãƒ†ãƒ¼ãƒ–ãƒ«å¼•ãã‚’ã—ã¦add (or sub) ã—ã¾ã™ã€‚ã“ã“ã§ $x_1 P_1$ ã¨ $x_2 P_2$ ã®ãƒ«ãƒ¼ãƒ—ã‚’ãã‚Œãã‚Œå›ã™ã®ã§ã¯ãªãã€dblã‚’å…±é€šåŒ–ã—ã€addã ã‘ã‚’ã™ã‚‹ã®ã§ã™ã€‚

```python
# return P1 * x1 + P2 * x2
def mul(P1, x1, P2, x2, w):
  # w ãƒ“ãƒƒãƒˆNAFãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
  naf1 = make_NAF(x1, w)
  naf2 = make_NAF(x2, w)
  tbl1 = make_table(P1, w)
  tbl2 = make_table(P2, w)
  Q = Ec()
  for i in range(len(naf1)):
    Q = dbl(Q)
    v = naf1[i]
    if v:
      Q = add(Q, tbl1[v]) if v > 0 else sub(Q, tbl1[-v])
    v = naf2[i]
    if v:
      Q = add(Q, tbl2[v]) if v > 0 else sub(Q, tbl2[-v])
  return Q
```

ã“ã®ã‚ˆã†ã«ã™ã‚‹ã¨ã€$x_i$ ãŒ $n$ ãƒ“ãƒƒãƒˆé•·ãªã‚‰å€‹åˆ¥ã«è¨ˆç®—ã™ã‚‹ã¨dblã®å›æ•°ãŒ $2n$ ã ã£ãŸã®ãŒã€$n$ ã«æ¸›ã‚Šã¾ã™ã€‚
[ECDSAã®æ¤œè¨¼](https://zenn.dev/herumi/articles/sd202203-ecc-2#ecdsa%E3%81%AE%E6%A4%9C%E8%A8%BC)ã§ã¯ã€`Q=P * u1 + S * u2` ã¨ã„ã†å‡¦ç†ãŒã‚ã‚Šã¾ã™ã€‚
å®Ÿã¯ã€ã“ã“ã§ã‚‚ãƒãƒ«ãƒã‚¹ã‚«ãƒ©ãƒ¼å€ç®—ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚

## GLVæ³•ã®ã‚³ã‚¢ã‚¢ã‚¤ãƒ‡ã‚¢
æ¥•å††æ›²ç·šãŒä¸ãˆã‚‰ã‚ŒãŸã¨ãã«ã€
1. ã‚ã‚‹ç‰¹æ®Šãªå®šæ•° $L$ ãŒã‚ã£ã¦ã€ä»»æ„ã®æ¥•å††æ›²ç·šã®ç‚¹ $P$ ã® $L$ å€ $L P$ ãŒé«˜é€Ÿã«æ±‚ã‚ã‚‰ã‚‹ï¼ˆalgo1ï¼‰
2. ä»»æ„ã®æ•´æ•° $x$ ã«å¯¾ã—ã¦ $x = a + b L$ ã¨ãªã‚‹æ•´æ•° $a$, $b$ ã§ãƒ“ãƒƒãƒˆé•·ãŒ $x$ ã®åŠåˆ†ãã‚‰ã„ã®ã‚µã‚¤ã‚ºã«ãªã‚‹ã‚‚ã®ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ï¼ˆalgo2ï¼‰

ã¨ã—ã¾ã™ã€‚
ã“ã®ã¨ãã€$Q=x P = (a+b L)P = aP + b (L P)$ ã¨ãªã‚Šã€$L P$ ã‚’é«˜é€Ÿã«æ±‚ã‚ãŸå¾Œã€$n=2$ ã®ãƒãƒ«ãƒã‚¹ã‚«ãƒ©ãƒ¼å€ç®—ã‚’åˆ©ç”¨ã—ã¦ $Q$ ã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚
$a$, $b$ ã®ãƒ“ãƒƒãƒˆé•·ãŒ $x$ ã®åŠåˆ†ãªã®ã§dbl ã®å›æ•°ãŒåŠåˆ†ã¨ãªã‚Šã€é«˜é€ŸåŒ–ã•ã‚Œã‚‹ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚

ã¨ã¦ã‚‚é¢ç™½ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã§ã™ã€‚ãŒã€ãã®ã‚ˆã†ãªéƒ½åˆã®ã‚ˆã„algo1, algo2ã¯è¦‹ã¤ã‹ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚
ä»¥ä¸‹ã§ã¯ã€ç‰¹ã«æ›²ç·šBLS12-381ã‚’å¿µé ­ã«èª¬æ˜ã—ã¾ã™ã€‚

## BLS12-381æ›²ç·šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
BLS12æ›²ç·šã¨å‘¼ã°ã‚Œã‚‹æ¥•å††æ›²ç·šã®ãƒ•ã‚¡ãƒŸãƒªãƒ¼ã¯ã€
1. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ $z$ ã‚’ã¨ã‚Šã€
2. $r=z^4-z^2+1$,
3. $p=(z-1)^2 r / 3 + z$,

ã§å®šã¾ã‚‹ç´ æ•° $p$ ä¸Šã® $y^2=x^3+4$ã§å®šã¾ã‚‹æ¥•å††æ›²ç·šï¼ˆ$a=0$, $b=4$ï¼‰ã§ã™ã€‚
$E(ğ”½_p)$ ã®ä½æ•°ã¯ç´ æ•° $r$, ãƒšã‚¢ãƒªãƒ³ã‚°ã®è¡Œãå…ˆãŒ $ğ”½_p$ ã®12æ¬¡æ‹¡å¤§ä½“ã¨ãªã‚Šã¾ã™ã€‚

BLS12-381ã¯ `z= -0xd201000000010000` ã§
- `r=0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001`
- `p=0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab`

ã§ã™ã€‚$p$ ã®ãƒ“ãƒƒãƒˆé•·ãŒ381ãªã®ãŒBLS12-381ã®ç”±æ¥ã§ã™ã€‚$r$ ã®ãƒ“ãƒƒãƒˆé•·ã¯255ã€‚

## è‡ªå·±æº–åŒå‹å†™åƒ
### $Ï†$ ã®å®šç¾©
å¤©ä¸‹ã‚Šã§ã™ãŒã€$w \in ğ”½_p$ ã‚’1ã®åŸå§‹3ä¹—æ ¹ï¼ˆ$w^3=1$, $w \neq 1$ï¼‰ã¨ã—ã¦ã€

$$
Ï†:E \ni (x, y) \mapsto (wx, y) \in E,\\
Ï†(0)=0
$$

ã¨ã„ã†å†™åƒã‚’è€ƒãˆã¾ã™ã€‚$E$ ã®å®šç¾©æ–¹ç¨‹å¼ãŒ $y^2=x^3+4$ ã§ $w^3=1$ ãªã®ã§ $(wx)^3+4=w^3 x^3 + 4 = x^3+4=y^2$ ãŒæˆã‚Šç«‹ã¡ã€$Ï†(x,y) \in E$ ã§ã™ã€‚

### $Ï†$ ã®æº–åŒå‹æ€§
æ¬¡ã«ã€æ¥•å††æ›²ç·šã®[åŠ ç®—å…¬å¼](https://zenn.dev/herumi/articles/projective-coordinate#%E6%A5%95%E5%86%86%E6%9B%B2%E7%B7%9A%E3%81%AE%E5%AE%9A%E7%BE%A9)ã‚’æ€ã„å‡ºã—ã¾ã™ã€‚
$P=(x_1,y_1)$, $Q=(x_2,y_2)$ ã¨ã—ã¾ã™ã€‚$a=0$ ãªã®ã§
$x_1 \neq x_2$ ã®ã¨ã $L=(y_2-y_1)/(x_2-x_1)$,  $x_1 = x_2$ ã®ã¨ã $L=(3x_1^2)/(2 y_1)$ ã¨ã—ã¦
$x_3 = L^2-(x_1+x_2)$, $y_3=L(x_1-x_3)-y_1$.

$Ï†(P)=(w x_1, y_1)$, $Ï†(Q)=(w x_2,y_2)$ ã‚’ä½¿ã£ã¦ $(x_3,y_3):=Ï†(P)+Ï†(Q)$ ã‚’è€ƒãˆã¾ã™ã€‚
$x_1 \neq x_2$ ã®ã¨ã $L'=(y_2-y_1)/(w x_2-w x_1)=L/w$.
$x_1 = x_2$ ã®ã¨ã $L'=(3 (w x_1)^2)/(2 y_1) = w^2 L = L/w$.

ã—ãŸãŒã£ã¦ $x'_3=L'^2-(w x_1 + w x_2)=L^2/w^2- w(x_1 + x_2) = w (L^2/w^3 - (x_1+x_2)) = w x_3$.
$y'_3=L'(w x_1 - w x_3) - y_1=L(x_1-x_3)-y_1=y_3$.
ã‚ˆã£ã¦ $(x'_3, y'_3)=(w x_3, y_3) = Ï†(x_3, y_3)$.
ã“ã‚Œã¯ $Ï†(P)+Ï†(Q)=Ï†(P+Q)$ ã‚’æ„å‘³ã—ã¾ã™ã€‚ã“ã®ã‚ˆã†ãªæ€§è³ªã‚’æº–åŒå‹ã¨ã„ã„ã€$E$ ã‹ã‚‰è‡ªåˆ†è‡ªèº«ã¸ã®å†™åƒãªã®ã§è‡ªå·±æº–åŒå‹å†™åƒ (endomorphism) ã¨ã„ã„ã¾ã™ã€‚
æ³¨æ„ : å®Ÿã¯å°„ï¼ˆmorphismï¼‰ $Ï† : E \rightarrow E$ ãŒ $Ï†(0)=0$ ã‚’æº€ãŸã›ã°è‡ªå‹•çš„ã«æº–åŒå‹ã¨ãªã‚‹ã“ã¨ã‚‚çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

## å®šæ•°å€å†™åƒ
å‰ç¯€ã§å®šç¾©ã—ãŸ $Ï†$ ã¯é¢ç™½ã„æ€§è³ªãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œã¯ $w \in ğ”½_p$ ã®ã¨ãã€$Ï†$ ã¯å®Ÿã¯å®šæ•°å€å†™åƒã§ã‚ã‚‹ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚
ã¤ã¾ã‚Šã€ã‚ã‚‹å®šæ•° $L$ ãŒã‚ã£ã¦ $Ï†(P) = L P$ ã¨æ›¸ã‘ã¾ã™ï¼ˆç†ç”±ã¯ä»Šå›ã¯ãƒ‘ã‚¹ï¼‰ã€‚

å®šæ•° $L$ ãŒå…·ä½“çš„ã«ä½•ãªã®ã‹æ±‚ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
$Ï†(x,y)=(w x,y)$ ãªã®ã§ $Ï†^2(x,y) = (w^2 x, y)$, $Ï†^3(x,y)=(w^3 x, y)=(x,y)$ ã§ã™ã€‚ã¤ã¾ã‚Š $Ï†^3$ ã¯ $E$ ä¸Šã®æ’ç­‰å†™åƒ $\text{id}_E$ ã§ã™ã€‚
$Ï†(P)=L P$ ã ã‹ã‚‰ $Ï†^3(P) = L^3 P = P$ ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚$P(\neq 0)$ ã¯ä½æ•° $r$ ã®å…ƒãªã®ã§ $L^3 \equiv 1 \pmod{r}$ ãŒæˆã‚Šç«‹ã¡ã¾ã™ã€‚

ã“ã“ã§æ³¨æ„ : $w$ ã¯ $ğ”½_p$ ã®å…ƒãªã®ã§ $w^3 \equiv 1 \pmod{p}$ ã§ã‚ã‚‹ã®ã«å¯¾ã—ã¦ $L$ ã¯ $\pmod{r}$ ã§è€ƒãˆã¦ã¾ã™ã€‚
$L^3-1=(L-1)(L^2+L+1)=0 \in ğ”½_p$ ã‚’è§£ã„ã¦ $L(\neq 1)$ ã‚’æ±‚ã‚ã¾ã™ï¼ˆæ±‚ã‚æ–¹ã¯ã¾ãŸã„ãšã‚Œï¼‰ã€‚

- `w=0x1a0111ea397fe699ec02408663d4de85aa0d857d89759ad4897d29650fb85f9b409427eb4f49fffd8bfd00000000aaac`
- `L=0xac45a4010001a40200000000ffffffff`

ã¨ãªã‚Šã¾ã—ãŸã€‚å®Ÿã¯ $L$ ã¯ $z^2-1$ ã«ç­‰ã—ãã€$r=z^4-z^2+1 = z^2(z^2-1)+1=L(L+1)+1$ ã¨ã„ã†é–¢ä¿‚ãŒæˆã‚Šç«‹ã£ã¦ã„ã¾ã™ã€‚

æ³¨æ„ : $w$, $L$ ã¯2æ¬¡æ–¹ç¨‹å¼ã®è§£ãªã®ã§ã€ã‚‚ã†ä¸€ã¤è§£ãŒã‚ã‚Šã€ãã‚Œã‚‰ã¯

- $w'=-1-w$=`0x5f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe`
- $L'=-L-1$=`0x73eda753299d7d483339d80809a1d804a7780001fffcb7fcfffffffe00000001`

ã§ã™ï¼ˆä»Šå›ã¯ã“ã¡ã‚‰ã¯ä½¿ã‚ãªã„ï¼‰ã€‚

è©±ã‚’ã¾ã¨ã‚ã‚‹ã¨ã€$w^2+w+1=0 \in ğ”½_p$ ã®è§£ã®ä¸€ã¤ã‚’ä½¿ã£ã¦ $Ï† : E \ni (x, y)=(wx, y) \in E$ ã¨ã™ã‚‹ã¨ã€$Ï†(P) = L P$, ãŸã ã— $L=z^2-1$, $r=L^2+L+1$ ã¨ãªã‚‹ã®ã§ã™ã€‚

## mcl-wasmã§ç¢ºèªã™ã‚‹
[mcl-wasm](https://www.npmjs.com/package/mcl-wasm)ã‚’ä½¿ã£ã¦ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚
æ¬¡ã® `test.js` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚Šã¾ã™ã€‚

```js
const mcl = require('mcl-wasm');

(async () => {
  await mcl.init(mcl.BLS12_381) // BLS12-381æ›²ç·šã§åˆæœŸåŒ–
  const P = mcl.hashAndMapToG1("abc") // é©å½“ãªæ¥•å††æ›²ç·šã®ç‚¹ã‚’ä½œã‚‹
  P.normalize() // ã‚¢ãƒ•ã‚£ãƒ³åº§æ¨™ã«å¤‰æ›
  console.log(`P.x=${P.getX().getStr(16)}`) // Pã®(x, y)åº§æ¨™ã‚’è¡¨ç¤º
  console.log(`P.y=${P.getY().getStr(16)}`)
  const L = new mcl.Fr()
  L.setStr('0xac45a4010001a40200000000ffffffff') // L ã‚’è¨­å®š
  console.log(`L=${L.getStr(16)}`)
  const Q = mcl.mul(P, L) // Q = P * L
  Q.normalize()
  console.log(`Q.x=${Q.getX().getStr(16)}`) // Qã®(x, y)åº§æ¨™ã‚’è¡¨ç¤º
  console.log(`Q.y=${Q.getY().getStr(16)}`)
  const w = mcl.div(Q.getX(), P.getX()) // w = Q.x / P.x
  console.log(`w=${w.getStr(16)}`)
})()
```


```bash
mkdir work
cd work
npm install -D mcl-wasm
node test.js
```

ã§
```
P.x=16379044479e745e2a14731fee35274308addf04b9e2cd0ef838069689333c4460054b518cc1ec87fce8b9144262e206
P.y=168c083fc11839bd7ef7e655364f65000b6c3e0bf41c60b835a2dd9991aabeefc10b943c0469f211632c62ddf706ee54
L=ac45a4010001a40200000000ffffffff
Q.x=15dd3a9d916f38f45f05dfdce5a795782cffb502859edfd7414f24f474a378f86b8ab2da8becb4ba2e57a0a032b00046
Q.y=168c083fc11839bd7ef7e655364f65000b6c3e0bf41c60b835a2dd9991aabeefc10b943c0469f211632c62ddf706ee54
w=1a0111ea397fe699ec02408663d4de85aa0d857d89759ad4897d29650fb85f9b409427eb4f49fffd8bfd00000000aaac
```
ã¨ã„ã†çµæœã«ãªã‚Šã¾ã—ãŸã€‚$P$ ã‚’ $L$ å€ã—ãŸ $Q$ ã® $y$ åº§æ¨™ $Q.y$ ã¯ $P.y$ ã¨åŒã˜ã§ $Q$ ã® $x$ åº§æ¨™ã¯ $P.x$ ã® $w$ å€ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚
ä»–ã® $P$ ã§ã‚‚åŒæ§˜ã®çµæœã«ãªã‚Šã¾ã™ã€‚
ã“ã‚Œã§GLVæ³•ã®ã‚³ã‚¢ã‚¢ã‚¤ãƒ‡ã‚¢ã®algo1ã¯è§£æ±ºã—ã¾ã—ãŸã€‚æ¬¡ã«algo2ã«ç§»ã‚Šã¾ã™ã€‚

## $x$ ã®åˆ†è§£
$r$ ã¯255ãƒ“ãƒƒãƒˆã€$L$ ã¯128ãƒ“ãƒƒãƒˆã§ã™ã€‚
$x \in [0, r-1]$ ã«å¯¾ã—ã¦ $x$ ã‚’ $L$ ã§å‰²ã£ãŸä½™ã‚Šã‚’ $a$ ($0 \le a < L$)ã€å•†ã‚’ $b$ ã¨ã™ã‚‹ã¨

$$
x = a + b L
$$

ã“ã‚Œã‚’ `(a, b) = split(x)` ã¨æ›¸ãã“ã¨ã«ã—ã¾ã™ã€‚

$r = L^2+L+1=(L+1)L+1$ ãªã®ã§ $0 \le b \le L+1$ ã§ã™ã€‚
$L+1$ ã‚‚ã¾ã 128ãƒ“ãƒƒãƒˆã§è¡¨ç¾ã§ãã‚‹ã®ã§ã€æœ€å¤§ç´„255ãƒ“ãƒƒãƒˆã®æ•´æ•° $x$ ã‚’æœ€å¤§128ãƒ“ãƒƒãƒˆã®æ•´æ•° $a$, $b$ ã‚’ä½¿ã£ã¦ $x=a + b L$ ã¨è¡¨ã›ã¾ã—ãŸã€‚
ã“ã‚Œã§algo2ã‚‚è§£æ±ºã§ã™ã€‚

## GLVæ³•ã®ã¾ã¨ã‚
BLS12-381æ›²ç·šã«ã¤ã„ã¦ä»Šã¾ã§ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦Pythonã§æ›¸ãã¨

```python
def mul(P, x):
  (a, b) = split(x)

  naf1 = make_NAF(a, w)
  naf2 = make_NAF(b, w)
  tbl1 = make_table(P, w)
  tbl2 = []
  for v in tbl1:
    tbl2.append(Ï†(v)) # L å€ã™ã‚‹
  # a P + b (L P) ã‚’MSMã™ã‚‹
  # ã“ã®ãƒšãƒ¼ã‚¸ã®2å€‹ç›®ã®MSMã¨åŒã˜
  return Q
```

`tbl2` ã¯æ¥•å††æ›²ç·šåŠ ç®— `add` ã‚’ä½¿ã£ã¦ `make_table` ã™ã‚‹ã‚ˆã‚Šã‚‚ã€ä½œã£ãŸ `tbl1` ã®å„è¦ç´ ã« $Ï†$ ã‚’é©ç”¨ã™ã‚‹æ–¹ãŒè»½ã„ï¼ˆ$ğ”½_p$ ã®ä¹—ç®—1å›ãšã¤ï¼‰ã§ã™ã€‚
æœ€åˆã«è¿°ã¹ãŸã‚ˆã†ã«ã€`dbl` ã®å›æ•°ãŒ256å›ã‹ã‚‰128å›ã¨åŠæ¸›ã—ã¾ã—ãŸã€‚ä»Šã¾ã§ç´¹ä»‹ã—ãŸã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ³•ã‚„ãã®æ”¹å–„ã€NAFã§ã¯ `dbl` ã®å›æ•°ã¯æ¸›ã‚‰ã›ãªã‹ã£ãŸã®ã§ã“ã‚Œã¯å¤§ããªæ”¹å–„ã§ã™ã€‚
