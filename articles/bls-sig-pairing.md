---
title: "ペアリングの構造とBLS署名の検証の高速化"
emoji: "📖"
type: "tech"
topics: ["BLS署名", "ペアリング", "ミラーループ", "最終べき", "検証"]
published: false
---
## 初めに
今回はペアリングの大まかな計算構造と、それを用いたBLS署名の検証の効率化方法を紹介します。実装レベルでは最低限、必須の知識です。

## 用語の復習
まずはいつもの用語の復習から。

$G_1$、$G_2$ を 位数 $r$ の加法巡回群、その生成元を $P$, $Q$ とします。

$$
G_1 := \Set{0,P,2P, \dots, (r-1)P},\\
G_2:=\Set{0, Q, 2Q, \dots, (r-1)Q}.
$$

ペアリングを

$$
e : G_1 \times G_2 \rightarrow G_T
$$
とします。$G_T$ は $g:=e(P,Q)$ を生成元とする位数 $r$ の乗法巡回群です。
$H_i : \Set{文字列} \rightarrow G_i$ を暗号学的に安全なハッシュ関数とします。

EthereumタイプのBLS署名は次の形でした。
- 鍵生成 : $s \in 𝔽_r$ をランダムにとり署名鍵とし、検証鍵を $pk:=s P \in G_1$ とする。
- 署名 Sign$(s,m)$ : メッセージ $m$ に対して $σ:=s H_2(m) \in G_2$ を署名とする。
- 検証 Verify$(pk, m, σ)$ : メッセージ $m$, 検証鍵 $pk$, 署名 $σ$ に対して $e(pk, H_2(m)) = e(P, σ)$ が成り立てば受理する。

検証ではペアリングを2回計算してそれを比較しています。ペアリングは重たい計算なので少しでも軽くしたいです。その方法を紹介する前にまずはペアリングの大まかな計算構造を説明します。

## ペアリングの構造と署名の高速化第一段階
ペアリングの計算はミラーループML（Miller Loop）と最終べきFE(Final Exponentiation)の部分からなります。

$$
e(P, Q) := FE(ML(P, Q)).
$$

最終べきは、ある定数 $a_0$ を用いた $FE(x) := x^{a_0}$ という形のべき乗計算です。今回は $FE$ の詳細には触れません。ミラーループ $ML$ の詳細は後ほどもう少し触れますが、ペアリングがこの形をしていることを利用してBLS署名の検証アルゴリズムを改善できます。

$FE(x)$ は単なるべき乗の計算なので任意の $x$, $y$ に対して $FE(xy) = FE(x) FE(y)$ が成り立ちます。
ペアリングの