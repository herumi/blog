---
title: "完全準同型暗号CKKSその2 エンコーディングとPythonによる実装"
emoji: "🧮"
type: "tech"
topics: ["完全準同型暗号", "CKKS", "エンコーディング"]
published: false
---
## 初めに
前回、多項式環とベクトル空間の同型対応を紹介しました。今回はそれを使ってCKKSの平文のエンコーディングと、Pythonによる簡単な実装を紹介します。

## 前回の復習
$M$を4以上の2のべきの形の整数、$\xi:=e^{2\pi i/M}$, $N:=M/2$としたとき$σ:ℂ[X]/(X^N+1) \rightarrow  ℂ^N$を$σ(f):=(f(\xi), f(\xi^3), \dots, f(\xi^{2N-1}))$で定義し、それが環同型となっていることを示しました。

## 複素共役
複素数$z=a+bi$（$a,b \in ℝ）$に対して、複素共役を$conj(z):=a-bi$と書きます。markdownでチルダ$\tilde{z}$は表記しづらいので$conj$を使います。
複素数$z$, $w$の積の複素共役はそれぞれの複素共役です。

$$conj(zw)=conj(z)conj(w).$$

実数$a$の複素共役は変化しません。

$$conj(a)=a.$$

さて、$\xi$について$conj(\xi)=\xi^{M-1}$です。よって$conj(\xi^u)=\xi^{M-u}$です。
前回の1の8乗根の例を見ても、

$$
\begin{align*}
conj(\xi)&=\xi^7,\\
conj(\xi^2)&=\xi^6,\\
conj(\xi^3)&=\xi^5,\\
conj(\xi^4)&=\xi^4
\end{align*}
$$
が見て取れます。

## 実数係数多項式環
$f$が実数係数多項式なら$conj(f(\xi^{2j-1}))=f(conj(\xi^{2j-1}))=f(\xi^{M-2j+1})$です。だから$σ(f)=(f(\xi^{2j-1}))_{j=1,\dots,N}$は$N$次元ベクトルのうち、前半の$N/2$個の成分だけで後半は決まります。
そこで、$ℂ[X]$の前半だけを取り出す写像を定義します。

$$
π:  ℂ^N \ni (z_1, \dots, z_N) \mapsto (z_1, \dots, z_{N/2}) \in ℂ^{N/2}.
$$
